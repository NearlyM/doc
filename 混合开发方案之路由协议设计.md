# 混合开发方案之路由协议

> 随着项目越来越大，产品类型越来越多，开发人员越来越多，组件化开发日益迫切。原生开发也可以实现组件化，但是在热更新实现上比较困难。目前大前端的趋势，React native的普及以及RN的热更新，使得我们选择了RN和原生一起来开发新的APP基础框架。

对路由方案不清楚的，可以参考文章混合开发方案之路由框架设计

本文章主要分为一下几个部分：

1. 引子
2. 前提
3. 路由格式定义
4. 配置文件定义

### 1. 引子

> **那么混合开发方案中不同的模块该如何进行通信？**

可能通信大家觉得很简单，不就是传参数嘛？当然，这么说没有错，我们暴力的讲参数传递过去，让项目之间产生各种依赖，是可以实现项目的。

但是如何做到优雅的传参？如何做到统一的传参？

路由协议要求：

1. 通用
2. 易理解
3. 合理

- #### 通用

该路由方案中目前关联的模块包含以下几种：Android、iOS、React Native（以后可能扩展到Flutter或者更多其他的类型模块），所以就要求协议被这几种类型尽可能方便的解析。在我们常用的接口调用中，经常使用到json格式字符串，既然可以和平台去交互，那么当然不同模块之间也可以很好的去解析。

- #### 易理解

对于开发者，协议格式要一看即懂，不能太复杂，否则，不能称之为通用协议。

- #### 合理

合理性上的规范，主要是试协议在满足上面两个特点的基础上，可以涵盖传参的要求，例如参数类型。



### 2. 前提

基础类型的定义：

> ParamType:

```
0:string
1:jsonObject
2:jsonArray
```

> ParamBody:

```json
{
	"param_name": "deviceAlias",
    "param_type": 0,
    "param_content": "ddde"
}
```

- 参数说明

| 字段名称      | 类型   | 必须 | 描述                                                         |
| ------------- | ------ | ---- | ------------------------------------------------------------ |
| param_name    | string | 是   | 参数名字                                                     |
| param_type    | int    | 是   | 参数类型，具体类型见ParamType                                |
| param_content | string | 是   | content内容由具体的模块来规范，不过还是以上面的格式来定义，不能破坏整个协议 |



### 3. 路由格式定义

```json
{
    "des_url": "MsgMule",
    "param_num": 3,
    "params": {
        "param1":ParamBody,
        "param2":ParamBody,
        "param3":ParamBody,
    },
}

```

- 参数说明

| 字段名称  | 类型      | 必须 | 描述           |
| --------- | --------- | ---- | -------------- |
| des_url   | string    | 是   | 跳转的模块名   |
| param_num | int       | 是   | 参数个数       |
| params    | ParamBody | 是   | 具体的参数集合 |



### 4. 配置文件

配置文件的作用：约束跳转的模块。

我们先定义配置文件格式，再讲解配置文件具体使用方法。

`0`代表原生模块

`1`代表RN模块

`2`代表Flutter模块

```json
{
	"MsgModule":1,
    "LoginModule":0,
    "VideoModule":2,
}
```

对于上面的配置文件具体解释：

跳转消息模块：路由选择消息模块，模块对应的值为1（RN模块），会跳转至RN中的消息模块

跳转登录模块：路由选择登录模块，模块对应的值为0（原生模块），会跳转至原生中的登录模块

跳转视频模块：路由选择视频模块，模块对应的值为2（Flutter模块），会跳转至Flutter中的视频模块

